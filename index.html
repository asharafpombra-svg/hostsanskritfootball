<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Host Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* All your original CSS styles remain exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a5e1a;
            --secondary: #d4af37;
            --accent: #c62828;
            --light: #f5f5f5;
            --dark: #0d3d0d;
            --success: #4CAF50;
            --warning: #FF9800;
            --info: #2196F3;
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(255, 255, 255, 0.15);
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideDown 0.8s ease-out;
            border: 2px solid var(--secondary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--secondary), #fff, var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Login Section */
        .login-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 0 auto 30px;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        .login-section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--secondary), #e6c44c);
            color: var(--primary);
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #e6c44c, var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            animation: fadeInUp 0.8s ease-out;
        }

        .sync-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .pair-btn {
            background: var(--secondary);
            color: var(--primary);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pair-btn:hover {
            background: #e6c44c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid var(--card-border);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .stat-card i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover i {
            transform: scale(1.2);
        }

        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.4s both;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        .section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .category-tab.active {
            background: var(--secondary);
            color: var(--primary);
        }

        .category-tab:hover {
            transform: translateY(-2px);
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .team-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--secondary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-left: 4px solid #e6c44c;
        }

        .team-card h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-details {
            margin-bottom: 15px;
        }

        .team-details p {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .team-action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .team-action-btn:hover {
            transform: scale(1.05);
        }

        .view-details-btn {
            background: var(--info);
            color: white;
        }

        .edit-team-btn-action {
            background: var(--warning);
            color: white;
        }

        .remove-team-btn {
            background: var(--accent);
            color: white;
        }

        /* School Management */
        .school-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .school-category {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }

        .school-category h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .school-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .school-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .school-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .school-input {
            display: flex;
            gap: 10px;
        }

        .school-input input {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--card-border);
            background: rgba(0, 0, 0, 0.3);
            color: white;
        }

        /* Edit Team Modal */
        .edit-team-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }

        .edit-team-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--secondary);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .edit-team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 15px;
        }

        .edit-team-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border-left: 3px solid var(--secondary);
        }

        .form-section h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.full-width {
            grid-template-columns: 1fr;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .player-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        .player-form h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-team-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-team-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-team-btn.save {
            background: var(--success);
            color: white;
        }

        .edit-team-btn.cancel {
            background: var(--accent);
            color: white;
        }

        .edit-team-btn:hover {
            transform: translateY(-2px);
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: opacity 0.3s ease;
            border-left: 4px solid;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success);
            color: #a3d8a3;
            border-left-color: var(--success);
        }

        .error {
            background: rgba(198, 40, 40, 0.2);
            border: 1px solid var(--accent);
            color: #ffa3a3;
            border-left-color: var(--accent);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: var(--secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            transform: scale(1.2);
            color: #e6c44c;
        }

        /* Data Management */
        .data-management {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
        }

        .data-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .data-btn {
            background: var(--secondary);
            color: var(--primary);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 200px;
        }

        .data-btn:hover {
            background: #e6c44c;
            transform: translateY(-2px);
        }

        /* Tournament Bracket */
        .tournament-bracket {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bracket-stage {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .bracket-stage:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .bracket-stage h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .bracket-matches {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bracket-match {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .bracket-match:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .team-name {
            flex: 1;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .team-name.winner {
            background: rgba(76, 175, 80, 0.3);
            font-weight: bold;
        }

        .vs {
            margin: 0 10px;
            color: var(--secondary);
            font-weight: bold;
        }

        .pairing-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            text-align: center;
            border-radius: 10px;
            margin-top: 30px;
            animation: fadeInUp 0.8s ease-out 0.6s both;
            border: 1px solid var(--card-border);
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s ease;
        }

        .contact-item:hover {
            transform: scale(1.05);
        }

        .contact-item i {
            color: var(--secondary);
        }

        .developer {
            font-style: italic;
            opacity: 0.8;
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .team-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .school-management {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .team-actions {
                flex-direction: column;
            }
            
            .category-tabs {
                flex-direction: column;
            }
            
            .data-actions {
                flex-direction: column;
            }
            
            .data-btn {
                min-width: auto;
            }
            
            .tournament-bracket {
                grid-template-columns: 1fr;
            }
            
            .match-teams {
                flex-direction: column;
                gap: 10px;
            }
            
            .vs {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <h1 class="title">Tournament Host Dashboard</h1>
            <p>Ottapalam Sub District Sanskrit Football Tournament - Real-time Management</p>
        </div>
    </header>

    <div class="container">
        <!-- Login Section -->
        <section id="loginSection" class="login-section">
            <h2><i class="fas fa-lock"></i> Host Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password"><i class="fas fa-key"></i> Password</label>
                    <input type="password" id="password" name="password" required placeholder="Enter host password">
                </div>
                <button type="submit" class="submit-btn">
                    <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                </button>
            </form>
            <div id="loginMessage" class="message" style="display: none;"></div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <h2><i class="fas fa-tachometer-alt"></i> Tournament Management</h2>
                <div>
                    <button id="logoutBtn" class="submit-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="sync-controls">
                        <button id="generateBracketBtn" class="pair-btn">
                            <i class="fas fa-trophy"></i> Generate Tournament
                        </button>
                        <button id="resetBracketBtn" class="pair-btn">
                            <i class="fas fa-undo"></i> Reset Tournament
                        </button>
                        <button id="exportDataBtn" class="pair-btn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                        <button id="refreshDataBtn" class="pair-btn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="data-management">
                <h3><i class="fas fa-database"></i> Data Management</h3>
                <div class="data-actions">
                    <button class="data-btn" onclick="exportLocalData()">
                        <i class="fas fa-download"></i> Export All Data
                    </button>
                    <button class="data-btn" onclick="importLocalData()">
                        <i class="fas fa-upload"></i> Import Data
                    </button>
                    <button class="data-btn" onclick="syncWithCloud()">
                        <i class="fas fa-cloud"></i> Sync with Cloud
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(this.files[0])">
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="totalTeams">0</h3>
                    <p>Total Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-trophy"></i>
                    <h3 id="upTeams">0</h3>
                    <p>UP Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-futbol"></i>
                    <h3 id="hsTeams">0</h3>
                    <p>HS Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-alt"></i>
                    <h3 id="totalMatches">0</h3>
                    <p>Total Matches</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-sync-alt"></i>
                    <h3 id="teamCounter">0</h3>
                    <p>Teams Registered</p>
                    <small id="lastUpdate">Last update: --:--:--</small>
                </div>
            </div>

            <!-- School Management -->
            <div class="section">
                <h2><i class="fas fa-school"></i> School Management</h2>
                <div class="school-management">
                    <div class="school-category">
                        <h3><i class="fas fa-child"></i> UP Schools</h3>
                        <div class="school-list" id="upSchoolsList">
                            <!-- UP schools will be dynamically added here -->
                        </div>
                        <div class="school-input">
                            <input type="text" id="newUpSchool" placeholder="Add new UP school">
                            <button class="pair-btn" onclick="addSchool('up')">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div class="school-category">
                        <h3><i class="fas fa-user-graduate"></i> HS Schools</h3>
                        <div class="school-list" id="hsSchoolsList">
                            <!-- HS schools will be dynamically added here -->
                        </div>
                        <div class="school-input">
                            <input type="text" id="newHsSchool" placeholder="Add new HS school">
                            <button class="pair-btn" onclick="addSchool('hs')">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Registered Teams -->
            <div class="section">
                <h2><i class="fas fa-list"></i> Registered Teams</h2>
                <div class="category-tabs" id="teamsTabs">
                    <div class="category-tab active" data-category="all">All Teams</div>
                    <div class="category-tab" data-category="up">UP Teams</div>
                    <div class="category-tab" data-category="hs">HS Teams</div>
                </div>
                <div class="team-grid" id="teamsContainer">
                    <!-- Teams will be dynamically added here -->
                </div>
            </div>

            <!-- Tournament Bracket -->
            <div class="section">
                <h2><i class="fas fa-trophy"></i> Tournament Bracket</h2>
                <div class="pairing-controls">
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                        <option value="up">UP Category</option>
                        <option value="hs">HS Category</option>
                    </select>
                    <button id="viewBracketBtn" class="pair-btn">
                        <i class="fas fa-eye"></i> View Bracket
                    </button>
                </div>
                <div class="tournament-bracket" id="tournamentBracket">
                    <p style="text-align: center; padding: 40px; color: #ccc;">No tournament bracket generated yet. Click "Generate Tournament" to create one.</p>
                </div>
            </div>
        </section>

        <!-- Edit Team Modal -->
        <div id="editTeamModal" class="edit-team-modal">
            <div class="edit-team-content">
                <div class="edit-team-header">
                    <h2><i class="fas fa-edit"></i> Edit Team</h2>
                    <span class="close-modal" id="closeEditTeamModal">Ã—</span>
                </div>
                <div class="edit-team-form" id="editTeamForm">
                    <!-- Team form will be dynamically populated here -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>+91 90489 22948</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>ashrafpombra@gmail.com</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Ottapalam, Kerala</span>
                </div>
            </div>
            <div class="developer">
                <i class="fas fa-heart" style="color: #e74c3c;"></i> Designed by Fadi.v PTM HSS
            </div>
        </footer>
    </div>

    <script>
        // Supabase Configuration - Using your provided credentials
        const SUPABASE_URL = 'https://ggbuhexzigkhpshegtvq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnYnVoZXh6aWdraHBzaGVndHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDA4MDksImV4cCI6MjA3NzkxNjgwOX0.nvPTmUXIFOJfp875VkNty54HY7d9-871DI-q7pzouWs';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Password for host access
        const HOST_PASSWORD = "ashrafhost";
        
        // Data storage
        let registeredTeams = [];
        let schools = { up: [], hs: [] };
        let tournamentBrackets = { up: { stages: [] }, hs: { stages: [] } };
        
        // Global scoring data storage
        let allScoringEvents = [];
        let allPlayerGoals = {};
        
        // Real-time subscription
        let teamsSubscription = null;

        // Global variables for team editing
        let currentEditingTeam = null;
        let currentEditingTeamIndex = -1;

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const loginMessage = document.getElementById('loginMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const teamsContainer = document.getElementById('teamsContainer');
        const tournamentBracket = document.getElementById('tournamentBracket');
        const totalTeamsEl = document.getElementById('totalTeams');
        const upTeamsEl = document.getElementById('upTeams');
        const hsTeamsEl = document.getElementById('hsTeams');
        const totalMatchesEl = document.getElementById('totalMatches');
        const generateBracketBtn = document.getElementById('generateBracketBtn');
        const resetBracketBtn = document.getElementById('resetBracketBtn');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const refreshDataBtn = document.getElementById('refreshDataBtn');
        const categoryFilter = document.getElementById('categoryFilter');
        const viewBracketBtn = document.getElementById('viewBracketBtn');
        const upSchoolsList = document.getElementById('upSchoolsList');
        const hsSchoolsList = document.getElementById('hsSchoolsList');
        const teamCounter = document.getElementById('teamCounter');
        const lastUpdate = document.getElementById('lastUpdate');
        const teamsTabs = document.getElementById('teamsTabs');

        // Edit Team Modal Elements
        const editTeamModal = document.getElementById('editTeamModal');
        const closeEditTeamModal = document.getElementById('closeEditTeamModal');
        const editTeamForm = document.getElementById('editTeamForm');

        // Check if user is already logged in
        if (localStorage.getItem('hostLoggedIn') === 'true') {
            showDashboard();
            initializeDataSync();
        }
        
        // Login form submission
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            
            if (password === HOST_PASSWORD) {
                localStorage.setItem('hostLoggedIn', 'true');
                showDashboard();
                initializeDataSync();
                showLoginMessage('Login successful! Loading dashboard...', 'success');
            } else {
                showLoginMessage('Incorrect password. Please try again.', 'error');
            }
        });
        
        // Logout functionality
        logoutBtn.addEventListener('click', function() {
            if (teamsSubscription) {
                supabase.removeChannel(teamsSubscription);
            }
            localStorage.removeItem('hostLoggedIn');
            showLogin();
            showLoginMessage('Logged out successfully', 'success');
        });

        // Category tabs functionality
        teamsTabs.addEventListener('click', function(e) {
            if (e.target.classList.contains('category-tab')) {
                // Remove active class from all tabs
                teamsTabs.querySelectorAll('.category-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                // Add active class to clicked tab
                e.target.classList.add('active');
                // Render teams with selected category
                renderTeams(e.target.getAttribute('data-category'));
            }
        });
        
        // Close edit team modal
        closeEditTeamModal.addEventListener('click', function() {
            editTeamModal.style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === editTeamModal) {
                editTeamModal.style.display = 'none';
            }
        });

        // Enhanced data synchronization and team management
        async function initializeDataSync() {
            // Load initial data
            await loadTeamsFromSupabase();
            await loadSchoolsFromSupabase();
            await loadBracketsFromSupabase();
            
            // Load scoring data from localStorage
            loadScoringData();
            
            // Set up real-time subscription for teams
            teamsSubscription = supabase
                .channel('teams-changes')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'teams'
                    },
                    async (payload) => {
                        console.log('Teams change received:', payload);
                        await loadTeamsFromSupabase();
                        showMessage('<i class="fas fa-users"></i> New registration received!', 'success');
                    }
                )
                .subscribe();

            // Check every 30 seconds if subscription is alive
            setInterval(() => {
                if (localStorage.getItem('hostLoggedIn') === 'true') {
                    syncRegistrationData();
                }
            }, 30000);
        }

        // Load teams from Supabase
        async function loadTeamsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('teams')
                    .select(`
                        *,
                        players (*)
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // Convert to the format expected by your existing code
                registeredTeams = data.map(team => {
                    const teamData = {
                        id: team.id,
                        teamName: team.team_name,
                        schoolName: team.school_name,
                        category: team.category,
                        coachName: team.coach_name,
                        coachPhone: team.coach_phone,
                        submissionTime: new Date(team.submission_time).toLocaleString(),
                        timestamp: team.submission_time
                    };

                    // Add player data
                    if (team.players && team.players.length > 0) {
                        team.players.forEach((player, index) => {
                            teamData[`player${player.player_number}_name`] = player.player_name;
                            teamData[`player${player.player_number}_regno`] = player.registration_no;
                            teamData[`player${player.player_number}_class`] = player.class;
                        });
                    }

                    return teamData;
                });

                // Get active category from tabs
                const activeTab = teamsTabs.querySelector('.category-tab.active');
                const activeCategory = activeTab ? activeTab.getAttribute('data-category') : 'all';
                renderTeams(activeCategory);
                updateStats();
                updateTeamCounter();

            } catch (error) {
                console.error('Error loading teams:', error);
                showMessage('Error loading teams data', 'error');
            }
        }

        // Load schools from Supabase
        async function loadSchoolsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('schools')
                    .select('*')
                    .order('school_name');

                if (error) throw error;

                schools = { up: [], hs: [] };
                data.forEach(school => {
                    schools[school.category].push(school.school_name);
                });

                renderSchools();

            } catch (error) {
                console.error('Error loading schools:', error);
            }
        }

        // Load brackets from Supabase
        async function loadBracketsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('tournament_brackets')
                    .select('*')
                    .order('created_at');

                if (error) throw error;

                tournamentBrackets = { up: { stages: [] }, hs: { stages: [] } };
                
                data.forEach(bracket => {
                    if (!tournamentBrackets[bracket.category].stages) {
                        tournamentBrackets[bracket.category].stages = [];
                    }
                    
                    tournamentBrackets[bracket.category].stages.push({
                        name: bracket.stage_name,
                        matches: bracket.match_data.matches || []
                    });
                });

            } catch (error) {
                console.error('Error loading brackets:', error);
            }
        }
        
        // Show login section
        function showLogin() {
            loginSection.style.display = 'block';
            dashboard.style.display = 'none';
            loginForm.reset();
        }
        
        // Show dashboard
        function showDashboard() {
            loginSection.style.display = 'none';
            dashboard.style.display = 'block';
            renderSchools();
            renderTeams();
            updateStats();
        }
        
        // Show login message
        function showLoginMessage(message, type) {
            loginMessage.innerHTML = `<i class="fas fa-${getIconName(type)}"></i> ${message}`;
            loginMessage.className = `message ${type}`;
            loginMessage.style.display = 'flex';
            
            setTimeout(() => {
                loginMessage.style.display = 'none';
            }, 3000);
        }

        // Get icon name based on message type
        function getIconName(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                default: return 'info-circle';
            }
        }
        
        // Render schools
        function renderSchools() {
            upSchoolsList.innerHTML = '';
            hsSchoolsList.innerHTML = '';
            
            schools.up.forEach((school, index) => {
                const schoolItem = document.createElement('div');
                schoolItem.className = 'school-item';
                schoolItem.innerHTML = `
                    <span><i class="fas fa-school"></i> ${school}</span>
                `;
                upSchoolsList.appendChild(schoolItem);
            });
            
            schools.hs.forEach((school, index) => {
                const schoolItem = document.createElement('div');
                schoolItem.className = 'school-item';
                schoolItem.innerHTML = `
                    <span><i class="fas fa-school"></i> ${school}</span>
                `;
                hsSchoolsList.appendChild(schoolItem);
            });
        }
        
        // Add school
        async function addSchool(category) {
            const inputId = `new${category.charAt(0).toUpperCase() + category.slice(1)}School`;
            const input = document.getElementById(inputId);
            const schoolName = input.value.trim();
            
            if (schoolName) {
                try {
                    const { error } = await supabase
                        .from('schools')
                        .insert({
                            school_name: schoolName,
                            category: category
                        });

                    if (error) throw error;

                    // Reload schools from Supabase
                    await loadSchoolsFromSupabase();
                    input.value = '';
                    showMessage(`<i class="fas fa-school"></i> School added to ${category.toUpperCase()} category`, 'success');
                } catch (error) {
                    console.error('Error adding school:', error);
                    showMessage('Error adding school', 'error');
                }
            } else {
                showMessage('Please enter a school name', 'error');
            }
        }
        
        // Render teams with category filtering
        function renderTeams(category = 'all') {
            teamsContainer.innerHTML = '';
            
            let filteredTeams = registeredTeams;
            
            if (category !== 'all') {
                filteredTeams = registeredTeams.filter(team => team.category === category);
            }
            
            if (filteredTeams.length === 0) {
                teamsContainer.innerHTML = `<p style="text-align: center; padding: 40px; color: #ccc;">No ${category === 'all' ? '' : category.toUpperCase() + ' '}teams registered yet. Teams will appear here as they register.</p>`;
                return;
            }
            
            filteredTeams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.setAttribute('data-team-index', registeredTeams.indexOf(team));
                
                // Count players
                const playerCount = countPlayers(team);
                
                teamCard.innerHTML = `
                    <h3><i class="fas fa-users"></i> ${team.teamName}</h3>
                    <div class="team-details">
                        <p><i class="fas fa-school"></i> <strong>School:</strong> ${team.schoolName}</p>
                        <p><i class="fas fa-tag"></i> <strong>Category:</strong> ${team.category.toUpperCase()}</p>
                        <p><i class="fas fa-user-tie"></i> <strong>Coach:</strong> ${team.coachName}</p>
                        <p><i class="fas fa-phone"></i> <strong>Contact:</strong> ${team.coachPhone}</p>
                        <p><i class="fas fa-user"></i> <strong>Players:</strong> ${playerCount}/13</p>
                        <p><i class="fas fa-clock"></i> <strong>Registered:</strong> ${team.submissionTime}</p>
                    </div>
                    <div class="team-actions">
                        <button class="team-action-btn edit-team-btn-action" data-team-index="${registeredTeams.indexOf(team)}">
                            <i class="fas fa-edit"></i> Edit Team
                        </button>
                        <button class="team-action-btn remove-team-btn" data-team-index="${registeredTeams.indexOf(team)}">
                            <i class="fas fa-trash"></i> Remove Team
                        </button>
                    </div>
                `;
                
                teamsContainer.appendChild(teamCard);
            });
            
            // Add event listeners for team actions
            document.querySelectorAll('.edit-team-btn-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teamIndex = this.getAttribute('data-team-index');
                    editTeam(teamIndex);
                });
            });
            
            document.querySelectorAll('.remove-team-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teamIndex = this.getAttribute('data-team-index');
                    removeTeam(teamIndex);
                });
            });
        }

        // Count players in a team
        function countPlayers(team) {
            let count = 0;
            for (let i = 1; i <= 13; i++) {
                if (team[`player${i}_name`] && team[`player${i}_name`].trim()) {
                    count++;
                }
            }
            return count;
        }
        
        // Edit team function
        function editTeam(teamIndex) {
            currentEditingTeamIndex = parseInt(teamIndex, 10);
            currentEditingTeam = registeredTeams[currentEditingTeamIndex];
            
            if (!currentEditingTeam) {
                showMessage('Team not found', 'error');
                return;
            }
            
            // Create the edit form with school dropdown
            let formHTML = `
                <div class="form-section">
                    <h3><i class="fas fa-info-circle"></i> Team Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editTeamName"><i class="fas fa-users"></i> Team Name</label>
                            <input type="text" id="editTeamName" value="${currentEditingTeam.teamName || ''}" required>
                        </div>
                        <div class="form-group">
                            <label for="editSchoolName"><i class="fas fa-school"></i> School Name</label>
                            <select id="editSchoolName" required>
                                <option value="">Select School</option>
            `;
            
            // Add UP schools to dropdown
            formHTML += `<optgroup label="UP Schools">`;
            schools.up.forEach(school => {
                const selected = currentEditingTeam.schoolName === school ? 'selected' : '';
                formHTML += `<option value="${school}" ${selected}>${school}</option>`;
            });
            formHTML += `</optgroup>`;
            
            // Add HS schools to dropdown
            formHTML += `<optgroup label="HS Schools">`;
            schools.hs.forEach(school => {
                const selected = currentEditingTeam.schoolName === school ? 'selected' : '';
                formHTML += `<option value="${school}" ${selected}>${school}</option>`;
            });
            formHTML += `</optgroup>`;
            
            formHTML += `
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCategory"><i class="fas fa-tag"></i> Category</label>
                            <select id="editCategory" required>
                                <option value="up" ${currentEditingTeam.category === 'up' ? 'selected' : ''}>UP</option>
                                <option value="hs" ${currentEditingTeam.category === 'hs' ? 'selected' : ''}>HS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editCoachName"><i class="fas fa-user-tie"></i> Coach Name</label>
                            <input type="text" id="editCoachName" value="${currentEditingTeam.coachName || ''}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCoachPhone"><i class="fas fa-phone"></i> Coach Phone</label>
                            <input type="text" id="editCoachPhone" value="${currentEditingTeam.coachPhone || ''}" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3><i class="fas fa-users"></i> Player Details</h3>
                    <div class="players-grid" id="editPlayersGrid">
            `;
            
            // Add player fields
            for (let i = 1; i <= 13; i++) {
                const playerName = currentEditingTeam[`player${i}_name`] || '';
                const playerRegNo = currentEditingTeam[`player${i}_regno`] || '';
                const playerClass = currentEditingTeam[`player${i}_class`] || '';
                
                formHTML += `
                    <div class="player-form">
                        <h4><i class="fas fa-user"></i> Player ${i}</h4>
                        <div class="form-group">
                            <label for="editPlayer${i}Name">Player Name</label>
                            <input type="text" id="editPlayer${i}Name" value="${playerName}">
                        </div>
                        <div class="form-group">
                            <label for="editPlayer${i}RegNo">Registration No</label>
                            <input type="text" id="editPlayer${i}RegNo" value="${playerRegNo}">
                        </div>
                        <div class="form-group">
                            <label for="editPlayer${i}Class">Class</label>
                            <input type="text" id="editPlayer${i}Class" value="${playerClass}">
                        </div>
                    </div>
                `;
            }
            
            formHTML += `
                    </div>
                </div>
                
                <div class="edit-team-actions">
                    <button class="edit-team-btn save" id="saveTeamChanges">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button class="edit-team-btn cancel" id="cancelTeamEdit">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;
            
            editTeamForm.innerHTML = formHTML;
            
            // Add event listeners for the form buttons
            document.getElementById('saveTeamChanges').addEventListener('click', saveEditedTeam);
            document.getElementById('cancelTeamEdit').addEventListener('click', () => {
                editTeamModal.style.display = 'none';
            });
            
            // Show the edit modal
            editTeamModal.style.display = 'block';
        }
        
        // Save edited team function
        async function saveEditedTeam() {
            try {
                // Get form values
                const teamName = document.getElementById('editTeamName').value.trim();
                const schoolName = document.getElementById('editSchoolName').value.trim();
                const category = document.getElementById('editCategory').value;
                const coachName = document.getElementById('editCoachName').value.trim();
                const coachPhone = document.getElementById('editCoachPhone').value.trim();
                
                if (!teamName || !schoolName || !coachName || !coachPhone) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Collect player data
                const players = [];
                for (let i = 1; i <= 13; i++) {
                    const playerName = document.getElementById(`editPlayer${i}Name`).value.trim();
                    const playerRegNo = document.getElementById(`editPlayer${i}RegNo`).value.trim();
                    const playerClass = document.getElementById(`editPlayer${i}Class`).value.trim();
                    
                    if (playerName) {
                        players.push({
                            player_number: i,
                            player_name: playerName,
                            registration_no: playerRegNo,
                            class: playerClass
                        });
                    }
                }
                
                // Update team in Supabase
                const { error: teamError } = await supabase
                    .from('teams')
                    .update({
                        team_name: teamName,
                        school_name: schoolName,
                        category: category,
                        coach_name: coachName,
                        coach_phone: coachPhone
                    })
                    .eq('id', currentEditingTeam.id);

                if (teamError) throw teamError;

                // Delete existing players for this team
                const { error: deleteError } = await supabase
                    .from('players')
                    .delete()
                    .eq('team_id', currentEditingTeam.id);

                if (deleteError) throw deleteError;

                // Insert updated players
                if (players.length > 0) {
                    const playersToInsert = players.map(player => ({
                        ...player,
                        team_id: currentEditingTeam.id
                    }));

                    const { error: playersError } = await supabase
                        .from('players')
                        .insert(playersToInsert);

                    if (playersError) throw playersError;
                }

                // Reload teams
                await loadTeamsFromSupabase();
                
                // Close the modal
                editTeamModal.style.display = 'none';
                
                showMessage(`<i class="fas fa-users"></i> Team "${teamName}" updated successfully`, 'success');
                
            } catch (error) {
                console.error('Error updating team:', error);
                showMessage('Error updating team', 'error');
            }
        }
        
        // Remove team function
        async function removeTeam(teamIndex) {
            if (confirm('Are you sure you want to remove this team? This action cannot be undone.')) {
                try {
                    const team = registeredTeams[teamIndex];
                    
                    // Delete from Supabase (this will cascade to players due to foreign key)
                    const { error } = await supabase
                        .from('teams')
                        .delete()
                        .eq('id', team.id);

                    if (error) throw error;

                    // The real-time subscription will automatically update the UI
                    showMessage(`<i class="fas fa-trash"></i> Team "${team.teamName}" removed successfully`, 'success');
                    
                } catch (error) {
                    console.error('Error removing team:', error);
                    showMessage('<i class="fas fa-exclamation-circle"></i> Error removing team. Please try again.', 'error');
                }
            }
        }
        
        // Update statistics
        function updateStats() {
            totalTeamsEl.textContent = registeredTeams.length;
            
            const upTeams = registeredTeams.filter(team => team.category === 'up').length;
            const hsTeams = registeredTeams.filter(team => team.category === 'hs').length;
            
            upTeamsEl.textContent = upTeams;
            hsTeamsEl.textContent = hsTeams;
            
            // Update real-time counter
            updateTeamCounter();
        }
        
        // Real-time team counter
        function updateTeamCounter() {
            teamCounter.textContent = registeredTeams.length;
            lastUpdate.textContent = `Last update: ${new Date().toLocaleTimeString()}`;
        }
        
        // Show message
        function showMessage(message, type) {
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;

            // Insert message at top of container, before the dashboard section
            const container = document.querySelector('.container');
            if (container && dashboard) {
                container.insertBefore(messageDiv, dashboard);
            } else if (container) {
                container.appendChild(messageDiv);
            }

            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.style.opacity = '0';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.parentNode.removeChild(messageDiv);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Load scoring data from localStorage
        function loadScoringData() {
            const savedEvents = localStorage.getItem('allScoringEvents');
            const savedGoals = localStorage.getItem('allPlayerGoals');
            
            if (savedEvents) {
                allScoringEvents = JSON.parse(savedEvents);
            }
            
            if (savedGoals) {
                allPlayerGoals = JSON.parse(savedGoals);
            }
        }

        // Sync with cloud
        async function syncWithCloud() {
            await syncRegistrationData();
            showMessage('Data synchronized with cloud successfully!', 'success');
        }

        // Update syncRegistrationData function
        async function syncRegistrationData() {
            await loadTeamsFromSupabase();
            await loadSchoolsFromSupabase();
            await loadBracketsFromSupabase();
        }

        // Placeholder functions for other features
        function exportLocalData() {
            showMessage('Export functionality would be implemented here', 'success');
        }

        function importLocalData() {
            document.getElementById('importFile').click();
        }

        function handleFileImport(file) {
            showMessage('File import functionality would be implemented here', 'success');
        }

        // Tournament bracket functions
        function generateTournamentBrackets() {
            showMessage('Tournament bracket generation would be implemented here', 'success');
        }

        function resetTournament() {
            showMessage('Tournament reset would be implemented here', 'success');
        }

        // Add event listeners for tournament buttons
        document.getElementById('generateBracketBtn').addEventListener('click', generateTournamentBrackets);
        document.getElementById('resetBracketBtn').addEventListener('click', resetTournament);
        document.getElementById('exportDataBtn').addEventListener('click', exportLocalData);
        document.getElementById('refreshDataBtn').addEventListener('click', syncWithCloud);
    </script>
</body>
</html>
